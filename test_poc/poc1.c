#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <jemalloc/jemalloc.h>

int g_fd;
void print_my_jemalloc_data(void *opaque, const char *buf){
	write(g_fd,buf,strlen(buf));
}



int main(){
	for (int i=0; i<0x10000; i+=0x10) {
		malloc(i);
	}
	int fd = open("heap_stats.out",O_CREAT|O_WRONLY,0666);
	g_fd = fd;
	malloc_stats_print(print_my_jemalloc_data,NULL,NULL);
	return 0;
}

